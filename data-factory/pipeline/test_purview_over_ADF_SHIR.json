{
	"name": "test_purview_over_ADF_SHIR",
	"properties": {
		"description": "Calling Purview over Purview PE from ADF SHIR. Purview to Scan Storage Account over Private endpoint and ingest into Purview PE.",
		"activities": [
			{
				"name": "test_purview_over_shir",
				"type": "WebActivity",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://aia-purview.scan.purview.azure.com/datasources/Braze-ADLS/scans?api-version=2020-12-01-preview",
						"type": "Expression"
					},
					"connectVia": {
						"referenceName": "CurrentsOnPremIntegrationRuntime",
						"type": "IntegrationRuntimeReference"
					},
					"method": "GET",
					"authentication": {
						"type": "MSI",
						"resource": "https://purview.azure.net"
					}
				}
			},
			{
				"name": "get_scans",
				"type": "WebActivity",
				"dependsOn": [
					{
						"activity": "test_purview_over_shir",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://aia-purview.scan.purview.azure.com/datasources/Braze-ADLS/scans?api-version=2020-12-01-preview",
						"type": "Expression"
					},
					"connectVia": {
						"referenceName": "CurrentsOnPremIntegrationRuntime",
						"type": "IntegrationRuntimeReference"
					},
					"method": "GET",
					"authentication": {
						"type": "MSI",
						"resource": "https://purview.azure.net"
					}
				}
			},
			{
				"name": "create_sample_scan",
				"type": "WebActivity",
				"dependsOn": [
					{
						"activity": "get_scans",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://aia-purview.scan.purview.azure.com/datasources/Braze-ADLS/scans/Scan-07?api-version=2020-12-01-preview",
						"type": "Expression"
					},
					"connectVia": {
						"referenceName": "CurrentsOnPremIntegrationRuntime",
						"type": "IntegrationRuntimeReference"
					},
					"method": "PUT",
					"body": {
						"value": "{\n   \"name\":\"Scan-07\",\n   \"kind\":\"AdlsGen2Credential\",\n   \"properties\":{\n      \"connectedVia\":{\n         \"referenceName\":\"IntegrationRuntime-aiadsvm01\"\n      },\n      \"credential\":{\n         \"referenceName\":\"ADLS-Braze-SP-ClientKey\",\n         \"credentialType\":\"ServicePrincipal\"\n      },\n      \"scanRulesetType\":\"System\",\n      \"scanRulesetName\":\"AdlsGen2\"\n   }\n}",
						"type": "Expression"
					},
					"authentication": {
						"type": "MSI",
						"resource": "https://purview.azure.net"
					}
				}
			},
			{
				"name": "specify_options",
				"type": "WebActivity",
				"dependsOn": [
					{
						"activity": "create_sample_scan",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://aia-purview.scan.purview.azure.com/datasources/Braze-ADLS/scans/Scan-07/filters/custom?api-version=2020-12-01-preview",
						"type": "Expression"
					},
					"connectVia": {
						"referenceName": "CurrentsOnPremIntegrationRuntime",
						"type": "IntegrationRuntimeReference"
					},
					"method": "PUT",
					"body": {
						"value": "{\n   \"properties\":{\n      \"excludeUriPrefixes\":[\n         \"https://aiabrazev2pocadls.dfs.core.windows.net/landing\"\n      ],\n      \"includeUriPrefixes\":[\n         \"https://aiabrazev2pocadls.dfs.core.windows.net/\",\n         \"https://aiabrazev2pocadls.dfs.core.windows.net/bronze\"\n      ]\n   }\n}",
						"type": "Expression"
					},
					"authentication": {
						"type": "MSI",
						"resource": "https://purview.azure.net"
					}
				}
			},
			{
				"name": "start_scan",
				"type": "WebActivity",
				"dependsOn": [
					{
						"activity": "specify_options",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"url": {
						"value": "https://aia-purview.scan.purview.azure.com/datasources/Braze-ADLS/scans/Scan-07/run?api-version=2020-12-01-preview",
						"type": "Expression"
					},
					"connectVia": {
						"referenceName": "CurrentsOnPremIntegrationRuntime",
						"type": "IntegrationRuntimeReference"
					},
					"method": "POST",
					"body": {
						"scanLevel": "Full"
					},
					"authentication": {
						"type": "MSI",
						"resource": "https://purview.azure.net"
					}
				}
			}
		],
		"folder": {
			"name": "Purview-SHIR-demonstration"
		},
		"annotations": []
	}
}